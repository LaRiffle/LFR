{% extends "LFRStoreBundle::layout.html.twig" %}
{% block body %}

<div id="explore-page">
  {% set navbar = "LFRStoreBundle:Utils:nav.html.twig" %}
  {% set lateral_navbar = "LFRStoreBundle:Search:lateral.html.twig" %}
  {{ include(navbar, {'active': 'collection'}) }}
  <div class="container">
    <div class="row">
      <div class="col-sm-3">
        {{ include(lateral_navbar) }}
      </div>
      <div class="col-sm-9">
        <div>
          {{ render(controller('LFRStoreBundle:Creation:index')) }}
        </div>
        <!--
          {% set icon = "LFRStoreBundle:Search:new_icon.html.twig" %}
          {% for i in 1..8 %}
            {% set width = 150 + random(100) %}
            {% set top = random(300) %}
            {% set left = random(550) %}
            {{ include(icon, {'img_path' : asset('bundles/LFR/img/icons/' ~ i ~'.png'), 'width': width, 'top': top, 'left': left }) }}
          {% endfor %}
        -->

      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block script %}
<script>
  var selected_type_ids = []
  function filter(){
    var selected_items = 0;
    if(selected_type_ids.length == 0){
      selected_items--;
      $('.creation-icon').each(function(){
            $(this).show();
            selected_items++;
      });
    } else {
      $('.creation-icon').each(function(){
        if($(this).attr('data-type') != null){
          console.log('--');
          var type_ids = $(this).attr('data-type').split(',').map(Number);
          var has_one_type = false;
          for(index in type_ids){
            var type_id = type_ids[index];
            has_one_type = has_one_type || selected_type_ids.includes(type_id)
            console.log(type_id, selected_type_ids, selected_type_ids.includes(type_id));
          }
          if(has_one_type){
            $(this).show();
            selected_items++;
          } else {
            $(this).hide();
          }
        }
      });
    }
    if(selected_items > 0){
      $('#number_results').html('('+selected_items+')');
    } else {
      $('#number_results').html('');
    }
  }
  $('#menu_lateral a.filter').on('click', function(e){
    e.preventDefault();
    var $input = $(this).find("input").first();
    $input.prop("checked", !$input.prop("checked"));
    var type_id = Number(this.href.split('-')[1]);
    if($input.prop("checked")){
      selected_type_ids.push(type_id);
    } else {
      var index = selected_type_ids.indexOf(type_id);
      if (index > -1) {
          selected_type_ids.splice(index, 1);
      }
    }
    console.log(selected_type_ids);
    filter();
  });
</script>
{% endblock %}
